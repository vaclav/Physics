package jetbrains.mps.samples.Physics.sandbox;

/*Generated by MPS */

import jetbrains.mps.samples.Physics.runtime.objects.forces.Force;
import org.ode4j.math.DVector3C;
import jetbrains.mps.samples.Physics.runtime.objects.World;
import jetbrains.mps.samples.Physics.runtime.objects.PhysicalEntity;
import jetbrains.mps.samples.Physics.runtime.vectors.VectorLike;
import jetbrains.mps.samples.Physics.runtime.vectors.InternalVector;
import org.iets3.core.expr.genjava.simpleTypes.rt.rt.AH;
import java.math.BigDecimal;
import java.math.BigInteger;

public class GravityForce implements Force {
  private Number G;

  public GravityForce(Number G1) {
    this.G = G1;
  }

  @Override
  public DVector3C getForce(World world, PhysicalEntity currentEntity) {

    VectorLike sum = InternalVector.ZERO;
    for (PhysicalEntity otherEntity : world.getEntities()) {
      if (otherEntity != currentEntity) {
        sum = sum.add(otherEntity.minus(currentEntity).resize(AH.div(AH.mul(AH.mul(G, otherEntity.getMass()), currentEntity.getMass()), BigDecimal.valueOf(Math.pow(currentEntity.minus(otherEntity).length().doubleValue(), ((Number) new BigInteger("2")).doubleValue())))));
      }
    }
    return sum.toDVector3C();
  }
}
