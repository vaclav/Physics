package jetbrains.mps.sample.Physics.runtime.objects;

/*Generated by MPS */

import org.ode4j.ode.DBody;
import jetbrains.mps.sample.Physics.runtime.objects.rendering.Fixture;
import java.util.ArrayList;
import jetbrains.mps.sample.Physics.runtime.objects.forces.Force;
import org.ode4j.ode.OdeHelper;
import org.ode4j.math.DVector3C;
import processing.core.PApplet;
import java.util.List;

public class PhysicalEntity {
  private DBody body;
  private World world;
  private Fixture fixture;
  /**
   * Forces applied on the entity
   */
  private ArrayList<Force> forces = new ArrayList();
  public PhysicalEntity(World world) {
    this.world = world;
    // Creating body 
    body = OdeHelper.createBody(world.getWorld());
  }
  public PhysicalEntity(World world, DVector3C initialPosition, Fixture fixture) {
    this(world);
    body.setPosition(initialPosition);
    // Calling fixture setter to apply fixture to body 
    this.setFixture(fixture);
  }
  public void applyForces() {
    for (Force force : forces) {
      body.addForce(force.getForce(world, this));
    }
  }
  public void render(PApplet ctx) {
    DVector3C position = body.getPosition();
    ctx.pushMatrix();
    ctx.translate((float) position.get0(), (float) position.get1(), (float) position.get2());
    fixture.render(ctx);
    ctx.popMatrix();
  }
  public void setFixture(Fixture fixture) {
    this.fixture = fixture;
    // Creating mass representation 
    fixture.bindToBody(body);
  }
  public DBody getBody() {
    return body;
  }
  public List<Force> getForces() {
    return forces;
  }
}
