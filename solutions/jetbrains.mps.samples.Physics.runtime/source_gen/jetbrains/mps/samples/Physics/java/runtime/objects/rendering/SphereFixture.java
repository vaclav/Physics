package jetbrains.mps.samples.Physics.java.runtime.objects.rendering;

/*Generated by MPS */

import jetbrains.mps.samples.Physics.java.runtime.objects.World;
import com.badlogic.gdx.graphics.g3d.utils.ModelBuilder;
import com.badlogic.gdx.graphics.g3d.Model;
import com.badlogic.gdx.graphics.VertexAttributes;
import com.badlogic.gdx.graphics.g3d.ModelInstance;
import org.ode4j.ode.DMass;
import org.ode4j.ode.OdeHelper;
import org.ode4j.ode.DGeom;

public class SphereFixture extends Fixture {
  private float radius;

  public SphereFixture(World world, Number radius, Texture texture) {
    super(world, texture);
    this.radius = radius.floatValue();
  }

  @Override
  public void setup(float scale) {
    ModelBuilder builder = new ModelBuilder();
    float size = radius * scale * 2;
    Model boxModel = builder.createSphere(size, size, size, 20, 20, texture.getMaterial(this.doEmitLight()), VertexAttributes.Usage.Position | VertexAttributes.Usage.Normal | VertexAttributes.Usage.TextureCoordinates);
    this.modelInstance = new ModelInstance(boxModel);
    super.setup(scale);
  }

  @Override
  protected DMass buildMass(double massValue) {
    DMass mass = OdeHelper.createMass();
    mass.setMass(massValue);
    mass.setSphere(massValue / getVolume(), radius);
    return mass;
  }


  @Override
  protected void setVolume(double volume) {
    radius = (float) Math.pow(volume * 3 / (Math.PI * 4), 0.3333);
  }
  @Override
  public DGeom buildGeometry() {
    return OdeHelper.createSphere(world.getSpace(), radius);
  }
  @Override
  public double getVolume() {
    return Math.PI * Math.pow(radius, 3) * 4 / 3;
  }
}
