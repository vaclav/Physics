package jetbrains.mps.samples.Physics.java.runtime.objects.rendering;

/*Generated by MPS */

import processing.core.PApplet;
import jetbrains.mps.samples.Physics.java.runtime.objects.World;
import processing.core.PGraphics;
import java.math.BigDecimal;
import java.math.RoundingMode;

public class MetricsRenderer {
  private float lineHeight;
  private float currentHeight = 15;
  private float ascent;
  public MetricsRenderer(PApplet applet) {
    ascent = applet.textAscent();
    lineHeight = ascent + applet.textDescent() + 3;
    applet.textLeading(3);
  }

  public void renderDefault(World world, PGraphics ctx) {
    StringBuilder str = new StringBuilder();

    // Time of simulation
    str.append("Elapsed time: ");
    str.append(world.getTime());
    str.append("s");
    if (world.isPaused()) {
      str.append(" [paused]");
    }
    ctx.fill(255);
    ctx.text(str.toString(), 5, 15);

    currentHeight = lineHeight * 2 + 5;
  }

  public void renderMetric(PGraphics ctx, String name, Object rendered) {
    if (rendered instanceof RenderableMetric) {
      RenderableMetric renderable = (RenderableMetric) rendered;
      // Draw name
      ctx.fill(255);
      ctx.text(name + ":", 5, currentHeight);

      // Draw metric
      ctx.pushMatrix();
      ctx.translate(9 + ctx.textWidth(name + ": "), currentHeight);
      currentHeight += lineHeight + renderable.render(ctx, -ascent, lineHeight);
      ctx.popMatrix();
    } else {
      // Draw name + metric at once
      ctx.fill(255);
      ctx.text(name + ": " + anyToString(rendered), 5, currentHeight);
      currentHeight += lineHeight;
    }
  }

  public static String anyToString(Object value) {
    if (value == null) {
      return "null";
    }

    if (value instanceof BigDecimal) {
      return as_obeszn_a0a0a0a2a9(value, BigDecimal.class).setScale(3, RoundingMode.HALF_DOWN).stripTrailingZeros().toEngineeringString();
    }
    return value.toString();
  }
  private static <T> T as_obeszn_a0a0a0a2a9(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
}
